# Woodlin 业务配置
# Data ID: woodlin-business.yml
# Group: DEFAULT_GROUP
# 描述: Woodlin 业务功能配置（安全、缓存、加密等）

# SnailJob 分布式任务调度配置
snail-job:
  # 是否启用SnailJob
  enabled: ${SNAIL_JOB_ENABLED:true}
  # 服务端地址
  server-address: ${SNAIL_JOB_SERVER_ADDRESS:localhost:8888}
  # 命名空间
  namespace: ${SNAIL_JOB_NAMESPACE:woodlin}
  # 组名称
  group-name: ${SNAIL_JOB_GROUP_NAME:woodlin-admin}
  # 客户端配置
  client:
    # 重试配置
    retry:
      # 重试次数
      max-retry-count: ${SNAIL_JOB_MAX_RETRY_COUNT:3}
      # 重试间隔(秒)
      retry-interval: ${SNAIL_JOB_RETRY_INTERVAL:30}

# Woodlin 安全配置
woodlin:
  # 构建信息配置
  build-info:
    # 是否在API响应中包含远程仓库URL（生产环境建议设置为false）
    include-remote-url: ${BUILD_INFO_INCLUDE_REMOTE_URL:false}
  security:
    # 用户活动监控配置
    activity-monitoring:
      # 是否启用用户活动监控
      enabled: ${ACTIVITY_MONITORING_ENABLED:true}
      # 用户无活动超时时间（秒），超时后自动登出，-1表示不限制
      timeout-seconds: ${ACTIVITY_MONITORING_TIMEOUT:1800}
      # 监控检查间隔（秒）
      check-interval-seconds: ${ACTIVITY_MONITORING_CHECK_INTERVAL:60}
      # 是否监控API请求活动
      monitor-api-requests: ${ACTIVITY_MONITORING_API:true}
      # 是否监控前端用户交互（键盘、鼠标）
      monitor-user-interactions: ${ACTIVITY_MONITORING_INTERACTIONS:true}
      # 活动监控警告提前时间（秒）
      warning-before-timeout-seconds: ${ACTIVITY_MONITORING_WARNING:300}
    password:
      # 是否启用密码策略
      enabled: ${PASSWORD_POLICY_ENABLED:true}
      # 是否要求首次登录修改密码
      require-change-on-first-login: ${PASSWORD_REQUIRE_FIRST_CHANGE:false}
      # 密码过期天数（0表示永不过期）
      expire-days: ${PASSWORD_EXPIRE_DAYS:0}
      # 密码过期前提醒天数
      warning-days: ${PASSWORD_WARNING_DAYS:7}
      # 最大密码错误次数
      max-error-count: ${PASSWORD_MAX_ERROR_COUNT:5}
      # 账号锁定时长（分钟）
      lock-duration-minutes: ${PASSWORD_LOCK_DURATION_MINUTES:30}
      # 是否启用强密码策略
      strong-password-required: ${PASSWORD_STRONG_REQUIRED:false}
      # 最小密码长度
      min-length: ${PASSWORD_MIN_LENGTH:6}
      # 最大密码长度
      max-length: ${PASSWORD_MAX_LENGTH:20}
      # 是否要求包含数字
      require-digits: ${PASSWORD_REQUIRE_DIGITS:false}
      # 是否要求包含小写字母
      require-lowercase: ${PASSWORD_REQUIRE_LOWERCASE:false}
      # 是否要求包含大写字母
      require-uppercase: ${PASSWORD_REQUIRE_UPPERCASE:false}
      # 是否要求包含特殊字符
      require-special-chars: ${PASSWORD_REQUIRE_SPECIAL_CHARS:false}
  # API加密配置
  api:
    encryption:
      # 是否启用加密功能
      enabled: ${API_ENCRYPTION_ENABLED:false}
      # 加密算法类型：AES, RSA, SM4
      algorithm: ${API_ENCRYPTION_ALGORITHM:AES}
      # AES 加密密钥（Base64编码，建议使用128/192/256位密钥）
      aes-key: ${API_ENCRYPTION_AES_KEY:}
      # AES 初始化向量 IV（Base64编码）
      aes-iv: ${API_ENCRYPTION_AES_IV:}
      # AES 加密模式：CBC, ECB, CFB, OFB, CTR
      aes-mode: ${API_ENCRYPTION_AES_MODE:CBC}
      # AES 填充方式：PKCS5Padding, PKCS7Padding, NoPadding
      aes-padding: ${API_ENCRYPTION_AES_PADDING:PKCS5Padding}
      # RSA 公钥（Base64编码）
      rsa-public-key: ${API_ENCRYPTION_RSA_PUBLIC_KEY:}
      # RSA 私钥（Base64编码）
      rsa-private-key: ${API_ENCRYPTION_RSA_PRIVATE_KEY:}
      # RSA 密钥长度：1024, 2048, 4096
      rsa-key-size: ${API_ENCRYPTION_RSA_KEY_SIZE:2048}
      # SM4 加密密钥（Base64编码）
      sm4-key: ${API_ENCRYPTION_SM4_KEY:}
      # SM4 初始化向量 IV（Base64编码）
      sm4-iv: ${API_ENCRYPTION_SM4_IV:}
      # SM4 加密模式：CBC, ECB
      sm4-mode: ${API_ENCRYPTION_SM4_MODE:CBC}
      # 需要加密的接口路径模式列表（支持Ant风格通配符）
      include-patterns:
        # 示例配置（默认为空，表示不加密任何接口）
        # - /api/user/**        # 用户相关接口
        # - /api/*/sensitive/** # 所有模块的敏感数据接口
        # - /api/payment/**     # 支付相关接口
      # 排除加密的接口路径模式列表（优先级高于include-patterns）
      exclude-patterns:
        - /auth/login           # 登录接口通常不加密
        - /auth/logout          # 登出接口
        - /actuator/**          # 健康检查接口
      # 是否加密请求体
      encrypt-request: ${API_ENCRYPTION_REQUEST:true}
      # 是否加密响应体
      encrypt-response: ${API_ENCRYPTION_RESPONSE:true}
      # 加密数据的字段名
      encrypted-field-name: ${API_ENCRYPTION_FIELD_NAME:encryptedData}
      # 是否在响应头中添加加密标识
      add-encryption-header: ${API_ENCRYPTION_HEADER:true}
      # 加密标识响应头名称
      encryption-header-name: ${API_ENCRYPTION_HEADER_NAME:X-Encrypted}
  # 缓存配置
  cache:
    # 是否启用Redis二级缓存
    redis-enabled: ${CACHE_REDIS_ENABLED:true}
    # 字典缓存配置
    dictionary:
      # 是否启用字典缓存
      enabled: ${CACHE_DICTIONARY_ENABLED:true}
      # 缓存过期时间（秒）
      expire-seconds: ${CACHE_DICTIONARY_EXPIRE:3600}
      # 缓存刷新间隔（秒）
      refresh-interval-seconds: ${CACHE_DICTIONARY_REFRESH:1800}
    # 系统配置缓存配置
    config:
      # 是否启用配置缓存
      enabled: ${CACHE_CONFIG_ENABLED:true}
      # 缓存过期时间（秒）
      expire-seconds: ${CACHE_CONFIG_EXPIRE:7200}
      # 缓存刷新间隔（秒）
      refresh-interval-seconds: ${CACHE_CONFIG_REFRESH:3600}
  # 可搜索加密配置
  searchable-encryption:
    # 是否启用可搜索加密功能
    enabled: ${SEARCHABLE_ENCRYPTION_ENABLED:false}
    # 加密密钥（Base64编码，256位）
    # 生成方法：SearchableEncryptionUtil.generateKey(256)
    # 或使用命令：openssl rand -base64 32
    encryption-key: ${SEARCHABLE_ENCRYPTION_KEY:}
    # N-gram的大小，用于模糊搜索（默认2）
    ngram-size: ${SEARCHABLE_ENCRYPTION_NGRAM_SIZE:2}
    # 是否自动加密标注字段
    auto-encrypt: ${SEARCHABLE_ENCRYPTION_AUTO_ENCRYPT:true}
    # 是否自动生成搜索索引
    auto-generate-index: ${SEARCHABLE_ENCRYPTION_AUTO_INDEX:true}
    # 搜索索引字段的后缀
    index-field-suffix: ${SEARCHABLE_ENCRYPTION_INDEX_SUFFIX:_search_index}
    # 是否启用缓存
    enable-cache: ${SEARCHABLE_ENCRYPTION_CACHE_ENABLED:true}
    # 缓存过期时间（秒）
    cache-expire-seconds: ${SEARCHABLE_ENCRYPTION_CACHE_EXPIRE:3600}
    # 最大缓存条目数
    max-cache-size: ${SEARCHABLE_ENCRYPTION_MAX_CACHE:10000}
  # 响应配置
  response:
    # 响应字段过滤模式（全局默认配置）
    # - NONE: 不过滤，包含所有字段（默认）
    # - MINIMAL: 最小模式，仅包含 code 和 data
    # - CUSTOM: 自定义模式，根据下面的 include* 配置决定
    filter-mode: ${RESPONSE_FILTER_MODE:NONE}
    # 以下配置仅在 filter-mode=CUSTOM 时生效（全局默认配置）
    # 是否包含时间戳字段
    include-timestamp: ${RESPONSE_INCLUDE_TIMESTAMP:true}
    # 是否包含请求ID字段
    include-request-id: ${RESPONSE_INCLUDE_REQUEST_ID:false}
    # 是否包含消息字段
    include-message: ${RESPONSE_INCLUDE_MESSAGE:true}
    # 是否包含状态码字段
    include-code: ${RESPONSE_INCLUDE_CODE:true}
    # 是否启用请求级别的动态控制
    # 启用后，可以通过请求头动态控制每个请求的响应字段
    enable-request-control: ${RESPONSE_ENABLE_REQUEST_CONTROL:true}
    # 请求头名称，用于控制响应字段
    # 示例: X-Response-Fields: code,data,message
    # 示例: X-Response-Fields: -timestamp,-requestId (排除字段)
    request-header-name: ${RESPONSE_REQUEST_HEADER_NAME:X-Response-Fields}
  # CORS跨域配置
  cors:
    # 是否启用CORS（默认启用）
    enabled: ${CORS_ENABLED:true}
    # 允许的源配置
    # 注意：此处为默认配置，具体环境的配置请在 application-{profile}.yml 中覆盖
    # dev/test环境：使用通配符 "*" 方便开发调试
    # prod环境：配置具体域名保证安全性
    allowed-origin-patterns:
      - ${CORS_ALLOWED_ORIGIN_PATTERN:http://localhost:*}
    # 允许的HTTP方法
    allowed-methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
      - PATCH
    # 允许的请求头
    allowed-headers:
      - "*"
    # 暴露的响应头
    exposed-headers:
      - Authorization
      - Content-Type
      - X-Total-Count
    # 是否允许携带凭证
    allow-credentials: ${CORS_ALLOW_CREDENTIALS:true}
    # 预检请求缓存时间（秒）
    max-age: ${CORS_MAX_AGE:3600}
    # 应用的路径模式
    path-pattern: "/**"
